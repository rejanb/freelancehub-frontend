<div class="profile-container">
  <p-toast></p-toast>

  <p-card header="User Profile" class="w-full">
    <form [formGroup]="profileForm" (ngSubmit)="onSave()" class="p-fluid">
      <!-- Profile Picture Section -->
<!--      <div class="flex flex-column align-items-center mb-4">-->
<!--        <p-avatar-->
<!--          [image]="'assets/fav.png'"-->
<!--          size="xlarge"-->
<!--          shape="circle"-->
<!--          class="mb-3">-->
<!--        </p-avatar>-->

<!--        <p-fileUpload-->
<!--          mode="basic"-->
<!--          chooseLabel="Change Photo"-->
<!--          accept="image/*"-->
<!--          maxFileSize="1000000"-->
<!--          (onSelect)="onFileSelect($event)"-->
<!--          class="mb-2">-->
<!--        </p-fileUpload>-->

<!--        &lt;!&ndash; Remove selected image button &ndash;&gt;-->
<!--        <button-->
<!--          *ngIf="selectedFile"-->
<!--          pButton-->
<!--          type="button"-->
<!--          label="Remove Selected"-->
<!--          class="p-button-text p-button-sm mb-2"-->
<!--          (click)="clearSelectedFile()">-->
<!--        </button>-->

<!--        &lt;!&ndash; Preview indicator &ndash;&gt;-->
<!--        <small class="text-500" *ngIf="selectedFile">-->
<!--          Selected: {{ selectedFile.name }}-->
<!--        </small>-->
<!--      </div>-->

      <p-divider></p-divider>

      <!-- Basic Information -->
      <div class="grid">
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="username">Username *</label>
            <input
              style="width: 100%"
              id="username"
              pInputText
              formControlName="username"
              [disabled]="isLoading"
              placeholder="Enter your username" />
            <small class="p-error" *ngIf="profileForm.get('username')?.errors?.['required'] && profileForm.get('username')?.touched">
              Username is required
            </small>
            <small class="p-error" *ngIf="profileForm.get('username')?.errors?.['minlength'] && profileForm.get('username')?.touched">
              Username must be at least 3 characters
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="email">Email *</label>
            <input
              style="width: 100%"
              id="email"
              pInputText
              formControlName="email"
              [disabled]="true"
              readonly
              placeholder="Enter your email" />
            <small class="p-error" *ngIf="profileForm.get('email')?.errors?.['required'] && profileForm.get('email')?.touched">
              Email is required
            </small>
            <small class="p-error" *ngIf="profileForm.get('email')?.errors?.['email'] && profileForm.get('email')?.touched">
              Invalid email format
            </small>
          </div>
        </div>

        <div class="col-12">
          <div class="field">

            <label for="bio">Bio</label>
            <textarea
              style="width: 100%"
              id="bio"
              pTextarea
              formControlName="bio"
              rows="4"
              [disabled]="isLoading"
              placeholder="Tell us about yourself..."
              maxlength="500"></textarea>
            <small class="text-500">{{ profileForm.get('bio')?.value?.length || 0 }}/500 characters</small>
          </div>
        </div>

        <!-- Skills Section -->
        <div class="col-12">
          <div class="field">
            <label class="block text-900 mb-2">Skills</label>

            <!-- Display existing skills -->
            <div class="flex flex-wrap gap-2 mb-3" *ngIf="skillControls.length > 0">
              <p-chip

                *ngFor="let skill of skillControls; let i = index"
                [label]="skill.value"
                [removable]="true"
                (onRemove)="removeSkill(i)"
                styleClass="p-chip-outlined">
              </p-chip>
            </div>

            <!-- Add new skill -->
            <div class="p-inputgroup">
              <input
                pInputText
                [(ngModel)]="newSkill"
                [ngModelOptions]="{standalone: true}"
                placeholder="Add a skill..."
                (keyup.enter)="addSkill()"
                [disabled]="isLoading" />
              <button
                pButton
                type="button"
                icon="pi pi-plus"
                (click)="addSkill()"
                [disabled]="!newSkill.trim() || isLoading">
              </button>
            </div>
            <small class="text-500">Press Enter or click + to add skills</small>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2 justify-content-end mt-4">


        <button
          pButton
          type="button"
          label="Change Password"
          class="p-button-outlined"
          (click)="onChangePassword()">
        </button>

        <button
          pButton
          type="submit"
          [label]="isLoading ? 'Saving...' : 'Save Changes'"
          class="p-button-primary"
          [disabled]="profileForm.invalid || isLoading"
          [loading]="isLoading">
        </button>
      </div>
    </form>

    <p-divider></p-divider>

    <!-- Danger Zone -->
    <div class="danger-zone mt-4">
      <h5 class="text-red-500">Danger Zone</h5>
      <p class="text-sm text-600 mb-3">
        Once you delete your account, there is no going back. Please be certain.
      </p>
      <button
        pButton
        type="button"
        label="Delete Account"
        class="p-button-danger p-button-outlined"
        (click)="onDeleteAccount()">
      </button>
    </div>
  </p-card>

  <!-- Change Password Dialog -->
  <p-dialog
    header="Change Password"
    [(visible)]="showChangePasswordDialog"
    [modal]="true"
    [style]="{width: '400px'}"
    [draggable]="false"
    [resizable]="false">
    <form [formGroup]="changePasswordForm" (ngSubmit)="submitChangePassword()" class="p-fluid">
      <div class="field">
        <label for="current_password">Current Password</label>
        <input id="current_password" type="password" pInputText formControlName="current_password" required />
      </div>
      <div class="field">
        <label for="new_password">New Password</label>
        <input id="new_password" type="password" pInputText formControlName="new_password" required minlength="6" />
      </div>
      <div class="field">
        <label for="confirm_password">Confirm New Password</label>
        <input id="confirm_password" type="password" pInputText formControlName="confirm_password" required />
      </div>
      <div class="flex gap-2 justify-content-end mt-3">
        <button pButton type="button" label="Cancel" class="p-button-text" (click)="showChangePasswordDialog = false"></button>
        <button pButton type="submit" label="Change Password" [loading]="changingPassword" [disabled]="changePasswordForm.invalid || changingPassword"></button>
      </div>
    </form>
  </p-dialog>

  <!-- Delete Account Confirmation Dialog -->
  <p-dialog
    header="Delete Account"
    [(visible)]="showDeleteConfirmDialog"
    [modal]="true"
    [style]="{width: '400px'}"
    [draggable]="false"
    [resizable]="false">
    <div class="p-3">
      <p class="text-red-500 font-bold mb-3">Are you sure you want to delete your account? This action cannot be undone.</p>
      <div class="flex gap-2 justify-content-end mt-3">
        <button pButton type="button" label="Cancel" class="p-button-text" (click)="showDeleteConfirmDialog = false"></button>
        <button pButton type="button" label="Delete Account" class="p-button-danger" [loading]="deletingAccount" (click)="confirmDeleteAccount()"></button>
      </div>
    </div>
  </p-dialog>
</div>
