import{c as ei,d as ni,g as ci}from"./chunk-O247FIGI.js";import{a as ai,b as si}from"./chunk-PZM27246.js";import{a as ii,b as ti}from"./chunk-V3KS4TSK.js";import{a as Z}from"./chunk-LER6AJTK.js";import"./chunk-BTNTQWIB.js";import{a as X}from"./chunk-TSMETG7O.js";import{a as K,b as Q}from"./chunk-BKKMXYAV.js";import"./chunk-KJMQ5L5H.js";import"./chunk-NULHEHFH.js";import{f as H}from"./chunk-KEGNGRCI.js";import"./chunk-4YRY4IP2.js";import{f as $,i as U,t as z}from"./chunk-LBDSJBCK.js";import{Fa as J,Ga as Y,La as q,Na as G,Oa as oi,Pa as ri,na as y,o as j,ra as w}from"./chunk-SFRASIIN.js";import{Ic as O,Jb as A,Jc as F,Kb as _,Lb as T,Mb as C,Qb as k,Qc as P,Ra as n,Rb as x,Sa as b,Sb as N,Tb as V,Ub as L,Vb as D,Vc as W,a as M,ca as E,dc as R,eb as g,fc as B,hb as l,jb as S,kb as I,la as p,ma as m,qb as o,rb as r,sb as v,wb as h,xb as f,yb as u}from"./chunk-D3OC6ZHD.js";var pi=()=>({width:"450px"});function mi(s,t){if(s&1&&v(0,"p-badge",22),s&2){let i=u();l("value",i.unreadCount.toString())}}function fi(s,t){if(s&1&&(o(0,"span",23),_(1),r()),s&2){let i=u();n(),C(" ",i.unreadCount," unread ")}}function ui(s,t){if(s&1){let i=h();o(0,"button",36),f("click",function(a){p(i);let c=u().$implicit,d=u();return m(d.markSingleAsRead(c,a))}),r()}}function _i(s,t){if(s&1){let i=h();o(0,"div",37)(1,"button",38),f("click",function(a){p(i);let c=u().$implicit,d=u();return m(d.onActionClick(c,a))}),r()()}if(s&2){let i=u().$implicit;n(),l("label",i.action_text)}}function gi(s,t){if(s&1){let i=h();o(0,"div",24)(1,"div",25),f("click",function(){let a=p(i).$implicit,c=u();return m(c.onNotificationClick(a))}),o(2,"div",26),v(3,"i",27),o(4,"div",28)(5,"div",29)(6,"span",30),_(7),r(),o(8,"div",15)(9,"small",31),_(10),R(11,"date"),r(),g(12,ui,1,0,"button",32),o(13,"button",33),f("click",function(a){let c=p(i).$implicit,d=u();return m(d.deleteSingleNotification(c,a))}),r()()(),o(14,"p",34),_(15),r(),g(16,_i,2,1,"div",35),r()()()()}if(s&2){let i=t.$implicit;n(),S("surface-hover",!i.read_at)("surface-ground",i.read_at),n(2),S("pi-info-circle",i.notification_type==="system"||i.notification_type==="info")("pi-briefcase",i.notification_type==="job")("pi-file",i.notification_type==="proposal")("pi-file-edit",i.notification_type==="contract")("pi-money-bill",i.notification_type==="payment")("pi-envelope",i.notification_type==="message")("pi-star",i.notification_type==="review")("pi-check-circle",i.notification_type==="success")("pi-exclamation-triangle",i.notification_type==="warning")("pi-times-circle",i.notification_type==="error"),n(3),S("text-primary",!i.read_at),n(),C(" ",i.title," "),n(3),C(" ",B(11,31,i.created_at,"shortTime")," "),n(2),l("ngIf",!i.read_at),n(3),T(i.message),n(),l("ngIf",i.action_text&&i.action_url)}}function vi(s,t){s&1&&(o(0,"div",39),v(1,"i",40),o(2,"h3"),_(3,"No Notifications"),r(),o(4,"p",31),_(5,"You're all caught up!"),r()())}var li=class s{constructor(t,i,e,a){this.notificationService=t;this.tokenService=i;this.messageService=e;this.confirmationService=a}notifications=[];unreadCount=0;loading=!1;dateRange=[];notificationSubscription;unreadCountSubscription;filters={type:"",is_read:void 0,start_date:"",end_date:"",page:1,page_size:20};typeOptions=[{label:"All",value:""},{label:"Jobs",value:"job"},{label:"Proposals",value:"proposal"},{label:"Contracts",value:"contract"},{label:"Payments",value:"payment"},{label:"Messages",value:"message"},{label:"Reviews",value:"review"},{label:"System",value:"system"}];menuItems=[{label:"Mark All as Read",icon:"pi pi-check",command:()=>this.markAllAsRead()},{label:"Clear All",icon:"pi pi-trash",command:()=>this.confirmClearAll()}];ngOnInit(){this.setupWebSocket(),this.subscribeToNotifications(),this.loadNotifications()}ngOnDestroy(){this.notificationSubscription&&this.notificationSubscription.unsubscribe(),this.unreadCountSubscription&&this.unreadCountSubscription.unsubscribe(),this.notificationService.disconnectWebSocket()}setupWebSocket(){let t=this.tokenService.getCurrentUser(),i=this.tokenService.getToken();t?.id&&i&&this.notificationService.connectWebSocket(t.id,i)}subscribeToNotifications(){this.notificationSubscription=this.notificationService.notifications$.subscribe(t=>{this.notifications=t||[]}),this.unreadCountSubscription=this.notificationService.unreadCount$.subscribe(t=>{this.unreadCount=t})}loadNotifications(){this.loading=!0,this.notificationService.getNotifications(this.filters).subscribe({next:t=>{let i=t.results||t||[];this.notifications=i,this.notificationService.updateNotifications(i),this.loading=!1},error:t=>{console.error("Error loading notifications:",t),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load notifications"}),this.loading=!1}})}onDateSelect(){if(this.dateRange&&this.dateRange.length===2){let[t,i]=this.dateRange;this.filters.start_date=t.toISOString(),this.filters.end_date=i.toISOString(),this.loadNotifications()}}onNotificationClick(t){t.read_at||this.notificationService.markAsRead(t.id).subscribe({next:()=>{t.read_at=new Date().toISOString(),this.unreadCount=Math.max(0,this.unreadCount-1)},error:i=>{console.error("Error marking notification as read:",i)}}),t.action_url&&(window.location.href=t.action_url)}markAllAsRead(){this.notificationService.markAllAsRead().subscribe({next:()=>{this.notifications.forEach(t=>t.read_at=new Date().toISOString()),this.unreadCount=0,this.messageService.add({severity:"success",summary:"Success",detail:"All notifications marked as read"})},error:t=>{console.error("Error marking all notifications as read:",t),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to mark all notifications as read"})}})}confirmClearAll(){this.confirmationService.confirm({message:"Are you sure you want to clear all notifications? This action cannot be undone.",accept:()=>this.clearAllNotifications()})}clearAllNotifications(){this.notificationService.clearAllNotifications().subscribe({next:()=>{this.notifications=[],this.unreadCount=0,this.messageService.add({severity:"success",summary:"Success",detail:"All notifications cleared"})},error:t=>{console.error("Error clearing notifications:",t),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to clear notifications"})}})}markSingleAsRead(t,i){i.stopPropagation(),this.notificationService.markAsRead(t.id).subscribe({next:()=>{t.read_at=new Date().toISOString(),this.unreadCount=Math.max(0,this.unreadCount-1);let e=this.notificationService.getCurrentNotifications(),a=e.findIndex(c=>c.id===t.id);a!==-1&&(e[a]=M({},t),this.notificationService.updateNotifications(e)),this.messageService.add({severity:"success",summary:"Success",detail:"Notification marked as read"})},error:e=>{console.error("Error marking notification as read:",e),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to mark notification as read"})}})}deleteSingleNotification(t,i){i.stopPropagation(),this.confirmationService.confirm({message:"Are you sure you want to delete this notification?",accept:()=>{this.notificationService.deleteNotification(t.id).subscribe({next:()=>{this.notifications=this.notifications.filter(e=>e.id!==t.id),t.read_at||(this.unreadCount=Math.max(0,this.unreadCount-1)),this.messageService.add({severity:"success",summary:"Success",detail:"Notification deleted"})},error:e=>{console.error("Error deleting notification:",e),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to delete notification"})}})}})}onActionClick(t,i){i.stopPropagation(),t.action_url&&(window.location.href=t.action_url)}static \u0275fac=function(i){return new(i||s)(b(Z),b(X),b(w),b(y))};static \u0275cmp=E({type:s,selectors:[["app-notification-list"]],standalone:!0,features:[V([w,y]),L],decls:25,vars:17,consts:[["menu",""],[1,"grid"],[1,"col-12"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"flex","align-items-center","gap-3"],[1,"m-0"],["severity","danger",3,"value",4,"ngIf"],[1,"flex","gap-2"],["pButton","","icon","pi pi-check-circle","label","Mark All Read",1,"p-button-success","p-button-sm",3,"click","disabled"],["pButton","","icon","pi pi-trash","label","Clear All",1,"p-button-danger","p-button-sm",3,"click","disabled"],["pButton","","icon","pi pi-ellipsis-v",1,"p-button-text","p-button-sm",3,"click"],[3,"popup","model"],[1,"flex","justify-content-between","align-items-center","gap-2","mb-4"],["placeholder","Filter by type",1,"w-full","md:w-15rem",3,"ngModelChange","onChange","options","ngModel","showClear"],["selectionMode","range","placeholder","Date range",1,"w-full","md:w-15rem",3,"ngModelChange","onSelect","ngModel","showButtonBar"],[1,"flex","align-items-center","gap-2"],["class","text-primary font-medium",4,"ngIf"],["pButton","","icon","pi pi-refresh","title","Refresh notifications",1,"p-button-text","p-button-sm",3,"click","loading"],[1,"notifications-container"],["class","notification-item",4,"ngFor","ngForOf"],["class","text-center p-5",4,"ngIf"],["header","Confirm Action","icon","pi pi-exclamation-triangle"],["severity","danger",3,"value"],[1,"text-primary","font-medium"],[1,"notification-item"],[1,"p-3","border-round","mb-2","cursor-pointer",3,"click"],[1,"flex","align-items-start","gap-3"],[1,"pi","text-xl"],[1,"flex-1"],[1,"flex","justify-content-between","align-items-start"],[1,"font-medium"],[1,"text-500"],["pButton","","icon","pi pi-check","class","p-button-text p-button-sm p-button-success","title","Mark as read",3,"click",4,"ngIf"],["pButton","","icon","pi pi-trash","title","Delete notification",1,"p-button-text","p-button-sm","p-button-danger",3,"click"],[1,"line-height-3","my-2"],["class","mt-2",4,"ngIf"],["pButton","","icon","pi pi-check","title","Mark as read",1,"p-button-text","p-button-sm","p-button-success",3,"click"],[1,"mt-2"],["pButton","",1,"p-button-link","p-button-sm",3,"click","label"],[1,"text-center","p-5"],[1,"pi","pi-bell","text-6xl","text-500","mb-3"]],template:function(i,e){if(i&1){let a=h();o(0,"div",1)(1,"div",2)(2,"p-card")(3,"div",3)(4,"div",4)(5,"h2",5),_(6,"Notifications"),r(),g(7,mi,1,1,"p-badge",6),r(),o(8,"div",7)(9,"button",8),f("click",function(){return p(a),m(e.markAllAsRead())}),r(),o(10,"button",9),f("click",function(){return p(a),m(e.confirmClearAll())}),r(),o(11,"button",10),f("click",function(d){p(a);let di=A(13);return m(di.toggle(d))}),r(),v(12,"p-menu",11,0),r()(),o(14,"div",12)(15,"div",7)(16,"p-dropdown",13),N("ngModelChange",function(d){return p(a),x(e.filters.type,d)||(e.filters.type=d),m(d)}),f("onChange",function(){return p(a),m(e.loadNotifications())}),r(),o(17,"p-calendar",14),N("ngModelChange",function(d){return p(a),x(e.dateRange,d)||(e.dateRange=d),m(d)}),f("onSelect",function(){return p(a),m(e.onDateSelect())}),r()(),o(18,"div",15),g(19,fi,2,1,"span",16),o(20,"button",17),f("click",function(){return p(a),m(e.loadNotifications())}),r()()(),o(21,"div",18),g(22,gi,17,34,"div",19)(23,vi,6,0,"div",20),r()()()(),v(24,"p-confirmDialog",21)}i&2&&(n(7),l("ngIf",e.unreadCount>0),n(2),l("disabled",e.unreadCount===0),n(),l("disabled",!e.notifications||e.notifications.length===0),n(2),l("popup",!0)("model",e.menuItems),n(4),l("options",e.typeOptions),k("ngModel",e.filters.type),l("showClear",!0),n(),k("ngModel",e.dateRange),l("showButtonBar",!0),n(2),l("ngIf",e.unreadCount>0),n(),l("loading",e.loading),n(2),l("ngForOf",e.notifications),n(),l("ngIf",!e.notifications||e.notifications.length===0),n(),I(D(16,pi)))},dependencies:[W,O,F,P,j,z,$,U,G,q,ri,oi,ci,Q,K,si,ai,Y,J,ti,ii,H,ni,ei],styles:["[_nghost-%COMP%]     .notifications-container{max-height:calc(100vh - 20rem);overflow-y:auto}[_nghost-%COMP%]     .notification-item:last-child{margin-bottom:0}"]})};export{li as NotificationListComponent};
