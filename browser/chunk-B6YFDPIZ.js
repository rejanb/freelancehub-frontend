import{a as W}from"./chunk-QWDYQ2ZD.js";import{a as U,b as Q}from"./chunk-BKKMXYAV.js";import{b as H,c as J}from"./chunk-HNQGWLA6.js";import{a as K}from"./chunk-5PPEK6NX.js";import"./chunk-KJMQ5L5H.js";import{c as q,d as $}from"./chunk-NULHEHFH.js";import"./chunk-KEGNGRCI.js";import"./chunk-4YRY4IP2.js";import{c as w,d as f,f as N,g as B,j as D,l as O,n as R,s as k,u as V}from"./chunk-LBDSJBCK.js";import{La as A,Na as L,Oa as Y,Pa as z,i as E,k as I,l as M,o as T,ra as v,va as G}from"./chunk-SFRASIIN.js";import{Kb as i,Lb as d,Ra as a,Sa as m,Tb as x,Tc as _,Ub as C,Vc as F,a as S,b as h,ca as j,dc as u,eb as b,ec as y,hb as s,qb as e,rb as t,sb as l,xb as P}from"./chunk-D3OC6ZHD.js";function Z(p,n){p&1&&(e(0,"div",33)(1,"h3",2),i(2,"Payment Details"),t()())}function ee(p,n){p&1&&(e(0,"div",33)(1,"h3",2),i(2,"Payment Summary"),t()())}var X=class p{constructor(n,o,r,c,g,te){this.fb=n;this.route=o;this.router=r;this.paymentService=c;this.contractService=g;this.messageService=te;this.paymentForm=this.fb.group({project_id:[null,f.required],amount:[null,[f.required,f.min(1)]],description:["Payment for completed work"],payment_type:["completion"]})}paymentForm;processing=!1;projects=[];paymentTypes=[{label:"Project Completion",value:"completion"},{label:"Milestone Payment",value:"milestone"},{label:"Bonus Payment",value:"bonus"},{label:"Other",value:"other"}];ngOnInit(){this.loadProjects();let n=this.route.snapshot.queryParams.project;n&&this.paymentForm.patchValue({project_id:parseInt(n)})}loadProjects(){this.contractService.getContracts({status:"active"}).subscribe({next:n=>{this.projects=n.results?.map(o=>({id:o.id,title:o.proposal?.job?.title||"Untitled Project",freelancer:o.proposal?.user?.username,amount:o.amount}))||[]},error:n=>{console.error("Error loading projects:",n),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load projects"})}})}onProjectSelect(n){let o=this.projects.find(r=>r.id===n.value);o&&this.paymentForm.patchValue({amount:o.amount,description:`Payment for ${o.title}`})}calculateFee(){return(this.paymentForm.get("amount")?.value||0)*.05}calculateTotal(){return(this.paymentForm.get("amount")?.value||0)+this.calculateFee()}processPayment(){if(this.paymentForm.valid){this.processing=!0;let n=h(S({},this.paymentForm.value),{total_amount:this.calculateTotal(),platform_fee:this.calculateFee()});this.paymentService.createQuickPayment(n).subscribe({next:o=>{this.messageService.add({severity:"success",summary:"Payment Processed",detail:`Payment of $${this.calculateTotal().toFixed(2)} has been processed successfully`}),this.processing=!1,this.router.navigate(["/dashboard/payments"])},error:o=>{console.error("Payment error:",o),this.messageService.add({severity:"error",summary:"Payment Failed",detail:"Failed to process payment. Please try again."}),this.processing=!1}})}}static \u0275fac=function(o){return new(o||p)(m(k),m(E),m(I),m(K),m(W),m(v))};static \u0275cmp=j({type:p,selectors:[["app-pay-project"]],standalone:!0,features:[x([v]),C],decls:66,vars:16,consts:[[1,"pay-project"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"m-0"],[1,"text-500","mt-1","mb-0"],["pButton","","icon","pi pi-arrow-left","label","Back","routerLink","/dashboard/payments",1,"p-button-text"],[1,"grid"],[1,"col-12","md:col-8"],["pTemplate","header"],[1,"p-fluid",3,"ngSubmit","formGroup"],[1,"field"],["for","project"],["id","project","formControlName","project_id","optionLabel","title","optionValue","id","placeholder","Choose a project",3,"onChange","options"],["for","amount"],["id","amount","formControlName","amount","mode","currency","currency","USD","placeholder","0.00",3,"min","max"],["for","description"],["id","description","type","text","pInputText","","formControlName","description","placeholder","Payment for completed work, milestone, etc."],["for","payment_type"],["id","payment_type","formControlName","payment_type","optionLabel","label","optionValue","value","placeholder","Select payment type",3,"options"],[1,"flex","justify-content-end","gap-2","mt-4"],["pButton","","type","button","label","Cancel","routerLink","/dashboard/payments",1,"p-button-text"],["pButton","","type","submit","label","Process Payment","icon","pi pi-credit-card",1,"p-button-success",3,"loading","disabled"],[1,"col-12","md:col-4"],[1,"payment-summary"],[1,"summary-row"],[1,"font-medium"],[1,"summary-row","total"],[1,"font-bold"],[1,"font-bold","text-lg"],[1,"mt-4","p-3","bg-blue-50","border-round"],[1,"flex","align-items-center","gap-2","mb-2"],[1,"pi","pi-info-circle","text-blue-600"],[1,"font-medium","text-blue-800"],[1,"text-sm","text-blue-700","m-0","pl-3"],[1,"p-3"]],template:function(o,r){if(o&1&&(e(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),i(4,"Pay for Project"),t(),e(5,"p",3),i(6,"Make a payment to your freelancer"),t()(),l(7,"button",4),t(),e(8,"div",5)(9,"div",6)(10,"p-card"),b(11,Z,3,0,"ng-template",7),e(12,"form",8),P("ngSubmit",function(){return r.processPayment()}),e(13,"div",9)(14,"label",10),i(15,"Select Project *"),t(),e(16,"p-dropdown",11),P("onChange",function(g){return r.onProjectSelect(g)}),t()(),e(17,"div",9)(18,"label",12),i(19,"Payment Amount *"),t(),l(20,"p-inputNumber",13),t(),e(21,"div",9)(22,"label",14),i(23,"Payment Description"),t(),l(24,"input",15),t(),e(25,"div",9)(26,"label",16),i(27,"Payment Type"),t(),l(28,"p-dropdown",17),t(),e(29,"div",18),l(30,"button",19)(31,"button",20),t()()()(),e(32,"div",21)(33,"p-card"),b(34,ee,3,0,"ng-template",7),e(35,"div",22)(36,"div",23)(37,"span"),i(38,"Subtotal:"),t(),e(39,"span",24),i(40),u(41,"currency"),t()(),e(42,"div",23)(43,"span"),i(44,"Platform Fee (5%):"),t(),e(45,"span",24),i(46),u(47,"currency"),t()(),e(48,"div",25)(49,"span",26),i(50,"Total:"),t(),e(51,"span",27),i(52),u(53,"currency"),t()(),e(54,"div",28)(55,"div",29),l(56,"i",30),e(57,"span",31),i(58,"Payment Info"),t()(),e(59,"ul",32)(60,"li"),i(61,"Payments are processed securely via Stripe"),t(),e(62,"li"),i(63,"Freelancer receives payment instantly"),t(),e(64,"li"),i(65,"You'll receive an email confirmation"),t()()()()()()()()),o&2){let c;a(12),s("formGroup",r.paymentForm),a(4),s("options",r.projects),a(4),s("min",1)("max",1e4),a(8),s("options",r.paymentTypes),a(3),s("loading",r.processing)("disabled",r.paymentForm.invalid||r.processing),a(9),d(y(41,10,(c=r.paymentForm.get("amount"))==null?null:c.value)),a(6),d(y(47,12,r.calculateFee())),a(6),d(y(53,14,r.calculateTotal()))}},dependencies:[F,_,V,D,w,N,B,O,R,T,M,L,A,G,z,Y,J,H,$,q,Q,U],styles:[".pay-project[_ngcontent-%COMP%]   .payment-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 0;border-bottom:1px solid var(--surface-border)}.pay-project[_ngcontent-%COMP%]   .payment-summary[_ngcontent-%COMP%]   .summary-row.total[_ngcontent-%COMP%]{border-top:2px solid var(--surface-border);border-bottom:none;margin-top:.5rem;padding-top:1rem}"]})};export{X as PayProjectComponent};
