import{a as Z,b as ee}from"./chunk-PZM27246.js";import{i as J,l as K}from"./chunk-UXOIYKMU.js";import{a as Q,b as X}from"./chunk-FGEALCX4.js";import"./chunk-CP6ZTTNU.js";import"./chunk-BTNTQWIB.js";import{a as $}from"./chunk-TSMETG7O.js";import{a as V,b as U}from"./chunk-BKKMXYAV.js";import"./chunk-HNQGWLA6.js";import{a as Y}from"./chunk-5PPEK6NX.js";import"./chunk-KJMQ5L5H.js";import"./chunk-NULHEHFH.js";import"./chunk-KEGNGRCI.js";import"./chunk-4YRY4IP2.js";import{f as F,i as O,t as j}from"./chunk-LBDSJBCK.js";import{La as A,Na as N,Oa as q,Pa as G,l as L,o as D,q as W,va as z}from"./chunk-SFRASIIN.js";import{Jc as I,Kb as r,Lb as c,Mb as f,Qb as _,Qc as k,Ra as l,Rb as h,Sa as b,Sb as C,Tc as B,Ub as E,Vc as H,Wb as M,ca as S,dc as v,eb as g,ec as x,fc as T,hb as p,la as w,ma as P,qb as i,rb as n,sb as y,wb as R,xb as u,yb as d}from"./chunk-D3OC6ZHD.js";var ne=o=>["/dashboard/payments",o];function ie(o,a){if(o&1&&(i(0,"tr")(1,"th"),r(2,"Project/Description"),n(),i(3,"th"),r(4),n(),i(5,"th"),r(6,"Amount"),n(),i(7,"th"),r(8,"Status"),n(),i(9,"th"),r(10,"Date"),n(),i(11,"th"),r(12,"Actions"),n()()),o&2){let e=d();l(4),c(e.isClient?"Freelancer":"Client")}}function ae(o,a){if(o&1&&(i(0,"div",27),r(1),n()),o&2){let e=d().$implicit,t=d();l(),f(" ",t.getPaymentTypeLabel(e.payment_type)," ")}}function oe(o,a){if(o&1&&(i(0,"div",27),r(1),v(2,"currency"),n()),o&2){let e=d().$implicit;l(),f(" Fee: ",x(2,1,e.platform_fee)," ")}}function re(o,a){if(o&1){let e=R();i(0,"tr")(1,"td")(2,"div",18),r(3),n(),g(4,ae,2,1,"div",19),n(),i(5,"td")(6,"div",20)(7,"div",21),r(8),n(),i(9,"span"),r(10),n()()(),i(11,"td")(12,"span",22),r(13),v(14,"currency"),n(),g(15,oe,3,3,"div",19),n(),i(16,"td"),y(17,"p-tag",23),n(),i(18,"td")(19,"div"),r(20),v(21,"date"),n()(),i(22,"td")(23,"div",24),y(24,"button",25),i(25,"button",26),u("click",function(){let m=w(e).$implicit,s=d();return P(s.downloadReceipt(m))}),n()()()()}if(o&2){let e=a.$implicit,t=d();l(3),c(e.project_title||e.description),l(),p("ngIf",e.payment_type),l(4),f(" ",t.getUserInitials(e.counterpart_name)," "),l(2),c(e.counterpart_name||"Unknown"),l(3),c(x(14,10,e.amount)),l(2),p("ngIf",e.platform_fee),l(2),p("value",e.status)("severity",t.getStatusSeverity(e.status)),l(3),c(T(21,12,e.created_at,"medium")),l(4),p("routerLink",M(15,ne,e.id))}}function le(o,a){o&1&&y(0,"button",33)}function se(o,a){if(o&1&&(i(0,"tr")(1,"td",28)(2,"div",29),y(3,"i",30),i(4,"p",31),r(5,"No payments found"),n(),g(6,le,1,0,"button",32),n()()()),o&2){let e=d();l(6),p("ngIf",e.isClient)}}var te=class o{constructor(a,e){this.paymentService=a;this.tokenService=e}isClient=!1;loading=!1;payments=[];totalRecords=0;filters={status:null,dateRange:null,amountRange:null};statusOptions=[{label:"Completed",value:"completed"},{label:"Pending",value:"pending"},{label:"Failed",value:"failed"}];amountRanges=[{label:"$0 - $100",value:"0-100"},{label:"$100 - $500",value:"100-500"},{label:"$500 - $1000",value:"500-1000"},{label:"$1000+",value:"1000+"}];ngOnInit(){let a=this.tokenService.getCurrentUser();this.isClient=a?.type===W.CLIENT,this.loadPayments()}loadPayments(a){this.loading=!0;let e={page:a?a.first/a.rows+1:1,page_size:a?.rows||10};if(this.filters.status&&(e.status=this.filters.status),this.filters.dateRange&&this.filters.dateRange.length===2&&(e.start_date=this.filters.dateRange[0].toISOString(),e.end_date=this.filters.dateRange[1].toISOString()),this.filters.amountRange){let[t,m]=this.filters.amountRange.split("-");e.min_amount=parseInt(t),m!=="+"&&(e.max_amount=parseInt(m))}this.paymentService.getPayments(e).subscribe({next:t=>{this.payments=t.results||[],this.totalRecords=t.count||0,this.loading=!1},error:t=>{console.error("Error loading payments:",t),this.loading=!1}})}onPageChange(a){this.loadPayments(a)}resetFilters(){this.filters={status:null,dateRange:null,amountRange:null},this.loadPayments()}getStatusSeverity(a){switch(a){case"completed":return"success";case"pending":return"warning";case"failed":return"danger";default:return"info"}}getPaymentTypeLabel(a){switch(a){case"completion":return"Project Completion";case"milestone":return"Milestone Payment";case"bonus":return"Bonus Payment";default:return"Payment"}}getUserInitials(a){return a?a.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"?"}downloadReceipt(a){this.paymentService.getPaymentReceipt(a.id).subscribe({next:e=>{window.open(e.url,"_blank")},error:e=>{console.error("Error downloading receipt:",e)}})}static \u0275fac=function(e){return new(e||o)(b(Y),b($))};static \u0275cmp=S({type:o,selectors:[["app-payment-history"]],standalone:!0,features:[E],decls:32,vars:17,consts:[[1,"payment-history"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"m-0"],[1,"text-500","mt-1","mb-0"],["pButton","","icon","pi pi-arrow-left","label","Back","routerLink","/dashboard/payments",1,"p-button-text"],[1,"mb-4"],[1,"grid"],[1,"col-12","md:col-3"],[1,"block","font-medium","mb-2"],["optionLabel","label","optionValue","value","placeholder","All Status",1,"w-full",3,"ngModelChange","onChange","ngModel","options","showClear"],["selectionMode","range","placeholder","Select date range",1,"w-full",3,"ngModelChange","onSelect","ngModel","showButtonBar"],["optionLabel","label","optionValue","value","placeholder","All Amounts",1,"w-full",3,"ngModelChange","onChange","ngModel","options","showClear"],[1,"flex","gap-2"],["pButton","","label","Reset","icon","pi pi-refresh",1,"p-button-outlined","p-button-sm",3,"click"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} payments",3,"onLazyLoad","value","loading","paginator","rows","totalRecords","lazy","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"font-medium"],["class","text-sm text-500",4,"ngIf"],[1,"flex","align-items-center","gap-2"],[1,"user-avatar"],[1,"font-medium","text-lg"],[3,"value","severity"],[1,"flex","gap-1"],["pButton","","icon","pi pi-eye","pTooltip","View Details",1,"p-button-rounded","p-button-text","p-button-sm",3,"routerLink"],["pButton","","icon","pi pi-download","pTooltip","Download Receipt",1,"p-button-rounded","p-button-text","p-button-sm",3,"click"],[1,"text-sm","text-500"],["colspan","6",1,"text-center","p-4"],[1,"empty-state"],[1,"pi","pi-wallet","text-4xl","text-300","mb-3"],[1,"text-500"],["pButton","","label","Make First Payment","icon","pi pi-plus","class","p-button-sm","routerLink","/dashboard/payments/pay",4,"ngIf"],["pButton","","label","Make First Payment","icon","pi pi-plus","routerLink","/dashboard/payments/pay",1,"p-button-sm"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),r(4),n(),i(5,"p",3),r(6),n()(),y(7,"button",4),n(),i(8,"p-card",5)(9,"div",6)(10,"div",7)(11,"label",8),r(12,"Status"),n(),i(13,"p-dropdown",9),C("ngModelChange",function(s){return h(t.filters.status,s)||(t.filters.status=s),s}),u("onChange",function(){return t.loadPayments()}),n()(),i(14,"div",7)(15,"label",8),r(16,"Date Range"),n(),i(17,"p-calendar",10),C("ngModelChange",function(s){return h(t.filters.dateRange,s)||(t.filters.dateRange=s),s}),u("onSelect",function(){return t.loadPayments()}),n()(),i(18,"div",7)(19,"label",8),r(20,"Amount Range"),n(),i(21,"p-dropdown",11),C("ngModelChange",function(s){return h(t.filters.amountRange,s)||(t.filters.amountRange=s),s}),u("onChange",function(){return t.loadPayments()}),n()(),i(22,"div",7)(23,"label",8),r(24,"Actions"),n(),i(25,"div",12)(26,"button",13),u("click",function(){return t.resetFilters()}),n()()()()(),i(27,"p-card")(28,"p-table",14),u("onLazyLoad",function(s){return t.onPageChange(s)}),g(29,ie,13,1,"ng-template",15)(30,re,26,17,"ng-template",16)(31,se,7,1,"ng-template",17),n()()()),e&2&&(l(4),c(t.isClient?"Payment History":"Earnings History"),l(2),f(" ",t.isClient?"Track all your project payments":"View your earnings and withdrawals"," "),l(7),_("ngModel",t.filters.status),p("options",t.statusOptions)("showClear",!0),l(4),_("ngModel",t.filters.dateRange),p("showButtonBar",!0),l(4),_("ngModel",t.filters.amountRange),p("options",t.amountRanges)("showClear",!0),l(7),p("value",t.payments)("loading",t.loading)("paginator",!0)("rows",10)("totalRecords",t.totalRecords)("lazy",!0)("showCurrentPageReport",!0))},dependencies:[H,I,B,k,D,L,j,F,O,N,A,z,G,q,K,J,X,Q,U,V,ee,Z],styles:[".payment-history[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:var(--primary-color);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.875rem}.payment-history[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem}"]})};export{te as PaymentHistoryComponent};
