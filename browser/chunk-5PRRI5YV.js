import{a as X,b as Y}from"./chunk-BKKMXYAV.js";import{b as te,c as ae}from"./chunk-HNQGWLA6.js";import{a as ie}from"./chunk-5PPEK6NX.js";import"./chunk-KJMQ5L5H.js";import{c as K,d as Q}from"./chunk-NULHEHFH.js";import"./chunk-KEGNGRCI.js";import"./chunk-4YRY4IP2.js";import{c as D,d as s,f as G,g as O,j as R,l as j,m as L,n as H,s as U,u as $}from"./chunk-LBDSJBCK.js";import{La as z,Na as J,Oa as Z,Pa as ee,l as V,o as A,ra as S}from"./chunk-SFRASIIN.js";import{Jc as T,Kb as m,Lb as M,Mb as N,Ra as l,Sa as F,Tb as B,Tc as W,Ub as k,Vc as q,ca as I,dc as C,eb as p,ec as E,hb as u,jb as v,qb as o,rb as t,sb as c,xb as P,yb as x}from"./chunk-D3OC6ZHD.js";function le(i,n){if(i&1&&(o(0,"small",17),m(1),C(2,"currency"),t()),i&2){let a=x();l(),N(" Amount is required and must be between $1 and ",E(2,1,a.availableBalance)," ")}}function oe(i,n){i&1&&(o(0,"small",17),m(1," Payment method is required "),t())}function re(i,n){i&1&&(o(0,"small",17),m(1," Bank name is required "),t())}function me(i,n){i&1&&(o(0,"small",17),m(1," Account holder name is required "),t())}function de(i,n){i&1&&(o(0,"small",17),m(1," Account number is required "),t())}function ue(i,n){i&1&&(o(0,"small",17),m(1," Routing number is required "),t())}function ce(i,n){i&1&&(o(0,"small",17),m(1," SWIFT code is required "),t())}function pe(i,n){if(i&1&&(o(0,"div",18)(1,"div",9)(2,"label",19),m(3,"Bank Name"),t(),c(4,"input",20),p(5,re,2,0,"small",12),t(),o(6,"div",9)(7,"label",21),m(8,"Account Holder Name"),t(),c(9,"input",22),p(10,me,2,0,"small",12),t(),o(11,"div",9)(12,"label",23),m(13,"Account Number"),t(),c(14,"input",24),p(15,de,2,0,"small",12),t(),o(16,"div",9)(17,"label",25),m(18,"Routing Number"),t(),c(19,"input",26),p(20,ue,2,0,"small",12),t(),o(21,"div",9)(22,"label",27),m(23,"SWIFT Code"),t(),c(24,"input",28),p(25,ce,2,0,"small",12),t()()),i&2){let a,e,d,_,h,w,g,f,b,y,r=x();l(4),v("ng-invalid",((a=r.withdrawForm.get("account_details.bank_name"))==null?null:a.invalid)&&((a=r.withdrawForm.get("account_details.bank_name"))==null?null:a.touched)),l(),u("ngIf",((e=r.withdrawForm.get("account_details.bank_name"))==null?null:e.invalid)&&((e=r.withdrawForm.get("account_details.bank_name"))==null?null:e.touched)),l(4),v("ng-invalid",((d=r.withdrawForm.get("account_details.account_name"))==null?null:d.invalid)&&((d=r.withdrawForm.get("account_details.account_name"))==null?null:d.touched)),l(),u("ngIf",((_=r.withdrawForm.get("account_details.account_name"))==null?null:_.invalid)&&((_=r.withdrawForm.get("account_details.account_name"))==null?null:_.touched)),l(4),v("ng-invalid",((h=r.withdrawForm.get("account_details.account_number"))==null?null:h.invalid)&&((h=r.withdrawForm.get("account_details.account_number"))==null?null:h.touched)),l(),u("ngIf",((w=r.withdrawForm.get("account_details.account_number"))==null?null:w.invalid)&&((w=r.withdrawForm.get("account_details.account_number"))==null?null:w.touched)),l(4),v("ng-invalid",((g=r.withdrawForm.get("account_details.routing_number"))==null?null:g.invalid)&&((g=r.withdrawForm.get("account_details.routing_number"))==null?null:g.touched)),l(),u("ngIf",((f=r.withdrawForm.get("account_details.routing_number"))==null?null:f.invalid)&&((f=r.withdrawForm.get("account_details.routing_number"))==null?null:f.touched)),l(4),v("ng-invalid",((b=r.withdrawForm.get("account_details.swift_code"))==null?null:b.invalid)&&((b=r.withdrawForm.get("account_details.swift_code"))==null?null:b.touched)),l(),u("ngIf",((y=r.withdrawForm.get("account_details.swift_code"))==null?null:y.invalid)&&((y=r.withdrawForm.get("account_details.swift_code"))==null?null:y.touched))}}function se(i,n){i&1&&(o(0,"small",17),m(1," Valid PayPal email is required "),t())}function _e(i,n){if(i&1&&(o(0,"div",18)(1,"div",9)(2,"label",29),m(3,"PayPal Email"),t(),c(4,"input",30),p(5,se,2,0,"small",12),t()()),i&2){let a,e,d=x();l(4),v("ng-invalid",((a=d.withdrawForm.get("account_details.paypal_email"))==null?null:a.invalid)&&((a=d.withdrawForm.get("account_details.paypal_email"))==null?null:a.touched)),l(),u("ngIf",((e=d.withdrawForm.get("account_details.paypal_email"))==null?null:e.invalid)&&((e=d.withdrawForm.get("account_details.paypal_email"))==null?null:e.touched))}}var ne=class i{constructor(n,a,e){this.fb=n;this.paymentService=a;this.messageService=e;this.initForm()}withdrawForm;loading=!1;availableBalance=0;paymentMethodOptions=[{label:"Bank Transfer",value:"bank"},{label:"PayPal",value:"paypal"}];paymentMethodFields={bank:["bank_name","account_name","account_number","routing_number","swift_code"],paypal:["paypal_email"]};ngOnInit(){this.loadAvailableBalance(),this.setupPaymentMethodValidation()}initForm(){this.withdrawForm=this.fb.group({amount:[null,[s.required,s.min(1)]],payment_method:["",s.required],account_details:this.fb.group({bank_name:[""],account_name:[""],account_number:[""],routing_number:[""],swift_code:[""],paypal_email:[""]})})}setupPaymentMethodValidation(){this.withdrawForm.get("payment_method")?.valueChanges.subscribe(n=>{let a=this.withdrawForm.get("account_details");Object.keys(a.controls).forEach(e=>{a.get(e)?.clearValidators(),a.get(e)?.updateValueAndValidity()}),n==="bank"?this.paymentMethodFields.bank.forEach(e=>{a.get(e)?.setValidators([s.required]),a.get(e)?.updateValueAndValidity()}):n==="paypal"&&(a.get("paypal_email")?.setValidators([s.required,s.email]),a.get("paypal_email")?.updateValueAndValidity())})}loadAvailableBalance(){this.paymentService.getAvailableBalance().subscribe({next:n=>{this.availableBalance=n.balance,this.withdrawForm.get("amount")?.setValidators([s.required,s.min(1),s.max(this.availableBalance)]),this.withdrawForm.get("amount")?.updateValueAndValidity()},error:n=>{console.error("Error loading balance:",n),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load available balance"})}})}onSubmit(){if(this.withdrawForm.valid){this.loading=!0;let n={amount:this.withdrawForm.value.amount,payment_method:this.withdrawForm.value.payment_method,account_details:this.withdrawForm.value.account_details};this.paymentService.requestWithdrawal(n).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:"Withdrawal request submitted successfully"}),this.loading=!1,this.withdrawForm.reset(),this.loadAvailableBalance()},error:a=>{console.error("Error requesting withdrawal:",a),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to submit withdrawal request"}),this.loading=!1}})}else Object.keys(this.withdrawForm.controls).forEach(n=>{this.withdrawForm.get(n)?.markAsTouched()})}static \u0275fac=function(a){return new(a||i)(F(U),F(ie),F(S))};static \u0275cmp=I({type:i,selectors:[["app-withdraw"]],standalone:!0,features:[B([S]),k],decls:27,vars:19,consts:[[1,"grid"],[1,"col-12","md:col-6","md:col-offset-3"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"m-0"],["pButton","","icon","pi pi-arrow-left","label","Back","routerLink","/dashboard/payments",1,"p-button-text"],[1,"mb-4"],[1,"block","font-bold","mb-2"],[1,"text-2xl"],[1,"p-fluid",3,"ngSubmit","formGroup"],[1,"field"],["for","amount"],["id","amount","formControlName","amount",3,"min","max","mode","currency"],["class","p-error",4,"ngIf"],["for","payment_method"],["id","payment_method","formControlName","payment_method","placeholder","Select payment method",3,"options"],["formGroupName","account_details",4,"ngIf"],["pButton","","type","submit","label","Withdraw Funds",3,"loading","disabled"],[1,"p-error"],["formGroupName","account_details"],["for","bank_name"],["id","bank_name","type","text","pInputText","","formControlName","bank_name"],["for","account_name"],["id","account_name","type","text","pInputText","","formControlName","account_name"],["for","account_number"],["id","account_number","type","text","pInputText","","formControlName","account_number"],["for","routing_number"],["id","routing_number","type","text","pInputText","","formControlName","routing_number"],["for","swift_code"],["id","swift_code","type","text","pInputText","","formControlName","swift_code"],["for","paypal_email"],["id","paypal_email","type","email","pInputText","","formControlName","paypal_email"]],template:function(a,e){if(a&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"div",2)(4,"h2",3),m(5,"Withdraw Funds"),t(),c(6,"button",4),t(),o(7,"div",5)(8,"label",6),m(9,"Available Balance"),t(),o(10,"span",7),m(11),C(12,"currency"),t()(),o(13,"form",8),P("ngSubmit",function(){return e.onSubmit()}),o(14,"div",9)(15,"label",10),m(16,"Amount to Withdraw"),t(),c(17,"p-inputNumber",11),p(18,le,3,3,"small",12),t(),o(19,"div",9)(20,"label",13),m(21,"Payment Method"),t(),c(22,"p-dropdown",14),p(23,oe,2,0,"small",12),t(),p(24,pe,26,15,"div",15)(25,_e,6,3,"div",15),c(26,"button",16),t()()()()),a&2){let d,_,h,w,g,f;l(11),M(E(12,17,e.availableBalance)),l(2),u("formGroup",e.withdrawForm),l(4),v("ng-invalid",((d=e.withdrawForm.get("amount"))==null?null:d.invalid)&&((d=e.withdrawForm.get("amount"))==null?null:d.touched)),u("min",0)("max",e.availableBalance)("mode","currency")("currency","USD"),l(),u("ngIf",((_=e.withdrawForm.get("amount"))==null?null:_.invalid)&&((_=e.withdrawForm.get("amount"))==null?null:_.touched)),l(4),v("ng-invalid",((h=e.withdrawForm.get("payment_method"))==null?null:h.invalid)&&((h=e.withdrawForm.get("payment_method"))==null?null:h.touched)),u("options",e.paymentMethodOptions),l(),u("ngIf",((w=e.withdrawForm.get("payment_method"))==null?null:w.invalid)&&((w=e.withdrawForm.get("payment_method"))==null?null:w.touched)),l(),u("ngIf",((g=e.withdrawForm.get("payment_method"))==null?null:g.value)==="bank"),l(),u("ngIf",((f=e.withdrawForm.get("payment_method"))==null?null:f.value)==="paypal"),l(),u("loading",e.loading)("disabled",e.withdrawForm.invalid||e.loading||!e.availableBalance)}},dependencies:[q,T,W,A,V,$,R,D,G,O,j,H,L,J,z,ee,Z,Q,K,ae,te,Y,X],styles:["[_nghost-%COMP%]     .p-inputtext.ng-invalid.ng-touched{border-color:var(--red-500)}[_nghost-%COMP%]     .p-dropdown.ng-invalid.ng-touched .p-dropdown-trigger, [_nghost-%COMP%]     .p-dropdown.ng-invalid.ng-touched .p-dropdown-label{border-color:var(--red-500)}[_nghost-%COMP%]     .p-inputnumber.ng-invalid.ng-touched .p-inputtext{border-color:var(--red-500)}"]})};export{ne as WithdrawComponent};
